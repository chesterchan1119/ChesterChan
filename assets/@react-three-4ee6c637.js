import{_ as V}from"./@babel-98964cd2.js";import{r as d}from"./react-612f7b04.js";import{L as xe,T as jt,R as At,U as Tt,a as Lt,O as He,P as Be,S as Xe,b as Se,N as Dt,A as kt,B as Ft,M as zt,C as Wt,V as N,c as It,W as Ht,d as Bt,e as $t,f as Gt,g as Ut,h as Nt,i as qt,D as Vt,j as be,k as Xt,l as se,m as Yt,n as Zt,o as Kt}from"./three-85ffa1fd.js";import{u as Jt}from"./react-use-measure-33846a54.js";import{F as Qt,u as er}from"./its-fine-cd42da5c.js";import{R as tr,c as ie}from"./react-reconciler-bad81c96.js";import{s as Ye}from"./scheduler-765c72db.js";import{c as rr}from"./react-dom-77fb4078.js";import{c as it}from"./zustand-1f571bb2.js";import{G as $e,D as nr,M as Re,O as or}from"./three-stdlib-8c9d7cbd.js";import{m as st}from"./react-merge-refs-239dbb3c.js";import{s as ir,p as sr,c as ar}from"./suspend-react-4f9dedb1.js";const Ge={},cr=e=>void Object.assign(Ge,e);function lr(e,t){function r(n,{args:o=[],attach:p,...f},m){let P=`${n[0].toUpperCase()}${n.slice(1)}`,b;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const c=f.object;b=ne(c,{type:n,root:m,attach:p,primitive:!0})}else{const c=Ge[P];if(!c)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");b=ne(new c(...o),{type:n,root:m,attach:p,memoizedProps:{args:o}})}return b.__r3f.attach===void 0&&(b instanceof Ft?b.__r3f.attach="geometry":b instanceof zt&&(b.__r3f.attach="material")),P!=="inject"&&Ae(b,f),b}function i(n,o){let p=!1;if(o){var f,m;(f=o.__r3f)!=null&&f.attach?je(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),p=!0),p||(m=n.__r3f)==null||m.objects.push(o),o.__r3f||ne(o,{}),o.__r3f.parent=n,We(o),oe(o)}}function s(n,o,p){let f=!1;if(o){var m,P;if((m=o.__r3f)!=null&&m.attach)je(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const b=n.children.filter(u=>u!==o),c=b.indexOf(p);n.children=[...b.slice(0,c),o,...b.slice(c)],f=!0}f||(P=n.__r3f)==null||P.objects.push(o),o.__r3f||ne(o,{}),o.__r3f.parent=n,We(o),oe(o)}}function l(n,o,p=!1){n&&[...n].forEach(f=>h(o,f,p))}function h(n,o,p){if(o){var f,m,P;if(o.__r3f&&(o.__r3f.parent=null),(f=n.__r3f)!=null&&f.objects&&(n.__r3f.objects=n.__r3f.objects.filter(C=>C!==o)),(m=o.__r3f)!=null&&m.attach)et(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var b;n.remove(o),(b=o.__r3f)!=null&&b.root&&gr(o.__r3f.root,o)}const u=(P=o.__r3f)==null?void 0:P.primitive,g=p===void 0?o.dispose!==null&&!u:p;if(!u){var c;l((c=o.__r3f)==null?void 0:c.objects,o,g),l(o.children,o,g)}delete o.__r3f,g&&o.dispose&&o.type!=="Scene"&&Ye.unstable_scheduleCallback(Ye.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),oe(n)}}function v(n,o,p,f){var m;const P=(m=n.__r3f)==null?void 0:m.parent;if(!P)return;const b=r(o,p,n.__r3f.root);if(n.children){for(const c of n.children)c.__r3f&&i(b,c);n.children=n.children.filter(c=>!c.__r3f)}n.__r3f.objects.forEach(c=>i(b,c)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||h(P,n),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),i(P,b),b.raycast&&b.__r3f.eventCount&&b.__r3f.root.getState().internal.interaction.push(b),[f,f.alternate].forEach(c=>{c!==null&&(c.stateNode=b,c.ref&&(typeof c.ref=="function"?c.ref(b):c.ref.current=b))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:tr({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const p=n.getState().scene;p.__r3f&&(p.__r3f.root=n,i(p,o))},removeChildFromContainer:(n,o)=>{o&&h(n.getState().scene,o)},insertInContainerBefore:(n,o,p)=>{if(!o||!p)return;const f=n.getState().scene;f.__r3f&&s(f,o,p)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,p,f){var m;if(((m=n==null?void 0:n.__r3f)!=null?m:{}).primitive&&f.object&&f.object!==n)return[!0];{const{args:b=[],children:c,...u}=f,{args:g=[],children:C,...E}=p;if(!Array.isArray(b))throw new Error("R3F: the args prop must be an array!");if(b.some((x,O)=>x!==g[O]))return[!0];const _=pt(n,u,E,!0);return _.changes.length?[!1,_]:null}},commitUpdate(n,[o,p],f,m,P,b){o?v(n,f,P,b):Ae(n,p)},commitMount(n,o,p,f){var m;const P=(m=n.__r3f)!=null?m:{};n.raycast&&P.handlers&&P.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>ne(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:p,parent:f}=(o=n.__r3f)!=null?o:{};p&&f&&et(f,n,p),n.isObject3D&&(n.visible=!1),oe(n)},unhideInstance(n,o){var p;const{attach:f,parent:m}=(p=n.__r3f)!=null?p:{};f&&m&&je(m,n,f),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),oe(n)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():ie.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&T.fun(performance.now)?performance.now:T.fun(Date.now)?Date.now:()=>0,scheduleTimeout:T.fun(setTimeout)?setTimeout:void 0,cancelTimeout:T.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var Ze,Ke;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,at=()=>{var e;return(e=Ge.ColorManagement)!=null?e:null},ct=e=>e&&e.isOrthographicCamera,ur=e=>e&&e.hasOwnProperty("current"),pe=typeof window<"u"&&((Ze=window.document)!=null&&Ze.createElement||((Ke=window.navigator)==null?void 0:Ke.product)==="ReactNative")?d.useLayoutEffect:d.useEffect;function lt(e){const t=d.useRef(e);return pe(()=>void(t.current=e),[e]),t}function fr({set:e}){return pe(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ut extends d.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ut.getDerivedStateFromError=()=>({error:!0});const ft="__default",Je=new Map,dr=e=>e&&!!e.memoized&&!!e.changes;function dt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const le=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},T={obj:e=>e===Object(e)&&!T.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(T.str(e)||T.num(e))return e===t;const l=T.obj(e);if(l&&i==="reference")return e===t;const h=T.arr(e);if(h&&r==="reference")return e===t;if((h||l)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(l&&r==="shallow"&&i==="shallow"){for(v in s?t:e)if(!T.equ(e[v],t[v],{strict:s,objects:"reference"}))return!1}else for(v in s?t:e)if(e[v]!==t[v])return!1;if(T.und(v)){if(h&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function pr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function mr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ne(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function ze(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return r=i.reduce((l,h)=>l[h],e),{target:r,key:s}}else return{target:r,key:t}}const Qe=/-\d+$/;function je(e,t,r){if(T.str(r)){if(Qe.test(r)){const l=r.replace(Qe,""),{target:h,key:v}=ze(e,l);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:s}=ze(e,r);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=r(e,t)}function et(e,t,r){var i,s;if(T.str(r)){const{target:l,key:h}=ze(e,r),v=t.__r3f.previousAttach;v===void 0?delete l[h]:l[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function pt(e,{children:t,key:r,ref:i,...s},{children:l,key:h,ref:v,...a}={},y=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},p=Object.entries(s),f=[];if(y){const P=Object.keys(a);for(let b=0;b<P.length;b++)s.hasOwnProperty(P[b])||p.unshift([P[b],ft+"remove"])}p.forEach(([P,b])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&P==="object"||T.equ(b,a[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return f.push([P,b,!0,[]]);let u=[];P.includes("-")&&(u=P.split("-")),f.push([P,b,!1,u]);for(const g in s){const C=s[g];g.startsWith(`${P}-`)&&f.push([g,C,!1,g.split("-")])}});const m={...s};return o.memoizedProps&&o.memoizedProps.args&&(m.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(m.attach=o.memoizedProps.attach),{memoized:m,changes:f}}function Ae(e,t){var r,i,s;const l=(r=e.__r3f)!=null?r:{},h=l.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:a,changes:y}=dr(t)?t:pt(e,t),n=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let p=0;p<y.length;p++){let[f,m,P,b]=y[p];if(Oe(e)){const C="srgb",E="srgb-linear";f==="encoding"?(f="colorSpace",m=m===3001?C:E):f==="outputEncoding"&&(f="outputColorSpace",m=m===3001?C:E)}let c=e,u=c[f];if(b.length&&(u=b.reduce((g,C)=>g[C],e),!(u&&u.set))){const[g,...C]=b.reverse();c=C.reverse().reduce((E,_)=>E[_],e),f=g}if(m===ft+"remove")if(c.constructor){let g=Je.get(c.constructor);g||(g=new c.constructor,Je.set(c.constructor,g)),m=g[f]}else m=0;if(P)m?l.handlers[f]=m:delete l.handlers[f],l.eventCount=Object.keys(l.handlers).length;else if(u&&u.set&&(u.copy||u instanceof xe)){if(Array.isArray(m))u.fromArray?u.fromArray(m):u.set(...m);else if(u.copy&&m&&m.constructor&&u.constructor===m.constructor)u.copy(m);else if(m!==void 0){const g=u instanceof Wt;!g&&u.setScalar?u.setScalar(m):u instanceof xe&&m instanceof xe?u.mask=m.mask:u.set(m),!at()&&!v.linear&&g&&u.convertSRGBToLinear()}}else if(c[f]=m,c[f]instanceof jt&&c[f].format===At&&c[f].type===Tt){const g=c[f];Oe(g)&&Oe(v.gl)?g.colorSpace=v.gl.outputColorSpace:g.encoding=v.gl.outputEncoding}oe(e)}if(l.parent&&v.internal&&e.raycast&&n!==l.eventCount){const p=v.internal.interaction.indexOf(e);p>-1&&v.internal.interaction.splice(p,1),l.eventCount&&v.internal.interaction.push(e)}return!(y.length===1&&y[0][0]==="onUpdate")&&y.length&&(s=e.__r3f)!=null&&s.parent&&We(e),e}function oe(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function We(e){e.onUpdate==null||e.onUpdate(e)}function vr(e,t){e.manual||(ct(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function hr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ie.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}}function mt(e,t,r,i){const s=r.get(t);s&&(r.delete(t),r.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function gr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(s)}),r.capturedMap.forEach((i,s)=>{mt(r.capturedMap,t,i,s)})}function yr(e){function t(a){const{internal:y}=e.getState(),n=a.offsetX-y.initialClick[0],o=a.offsetY-y.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(a){return a.filter(y=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=y.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(a,y){const n=e.getState(),o=new Set,p=[],f=y?y(n.internal.interaction):n.internal.interaction;for(let c=0;c<f.length;c++){const u=le(f[c]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(a,n);function m(c){const u=le(c);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var g;u.events.compute==null||u.events.compute(a,u,(g=u.previousRoot)==null?void 0:g.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(c,!0):[]}let P=f.flatMap(m).sort((c,u)=>{const g=le(c.object),C=le(u.object);return!g||!C?c.distance-u.distance:C.events.priority-g.events.priority||c.distance-u.distance}).filter(c=>{const u=we(c);return o.has(u)?!1:(o.add(u),!0)});n.events.filter&&(P=n.events.filter(P,n));for(const c of P){let u=c.object;for(;u;){var b;(b=u.__r3f)!=null&&b.eventCount&&p.push({...c,eventObject:u}),u=u.parent}}if("pointerId"in a&&n.internal.capturedMap.has(a.pointerId))for(let c of n.internal.capturedMap.get(a.pointerId).values())o.has(we(c.intersection))||p.push(c.intersection);return p}function s(a,y,n,o){const p=e.getState();if(a.length){const f={stopped:!1};for(const m of a){const P=le(m.object)||p,{raycaster:b,pointer:c,camera:u,internal:g}=P,C=new N(c.x,c.y,0).unproject(u),E=S=>{var w,j;return(w=(j=g.capturedMap.get(S))==null?void 0:j.has(m.eventObject))!=null?w:!1},_=S=>{const w={intersection:m,target:y.target};g.capturedMap.has(S)?g.capturedMap.get(S).set(m.eventObject,w):g.capturedMap.set(S,new Map([[m.eventObject,w]])),y.target.setPointerCapture(S)},x=S=>{const w=g.capturedMap.get(S);w&&mt(g.capturedMap,m.eventObject,w,S)};let O={};for(let S in y){let w=y[S];typeof w!="function"&&(O[S]=w)}let M={...m,...O,pointer:c,intersections:a,stopped:f.stopped,delta:n,unprojectedPoint:C,ray:b.ray,camera:u,stopPropagation(){const S="pointerId"in y&&g.capturedMap.get(y.pointerId);if((!S||S.has(m.eventObject))&&(M.stopped=f.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find(w=>w.eventObject===m.eventObject))){const w=a.slice(0,a.indexOf(m));l([...w,m])}},target:{hasPointerCapture:E,setPointerCapture:_,releasePointerCapture:x},currentTarget:{hasPointerCapture:E,setPointerCapture:_,releasePointerCapture:x},nativeEvent:y};if(o(M),f.stopped===!0)break}}return a}function l(a){const{internal:y}=e.getState();for(const n of y.hovered.values())if(!a.length||!a.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const p=n.eventObject.__r3f,f=p==null?void 0:p.handlers;if(y.hovered.delete(we(n)),p!=null&&p.eventCount){const m={...n,intersections:a};f.onPointerOut==null||f.onPointerOut(m),f.onPointerLeave==null||f.onPointerLeave(m)}}}function h(a,y){for(let n=0;n<y.length;n++){const o=y[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function v(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return y=>{const{internal:n}=e.getState();"pointerId"in y&&n.capturedMap.has(y.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(y.pointerId)&&(n.capturedMap.delete(y.pointerId),l([]))})}}return function(n){const{onPointerMissed:o,internal:p}=e.getState();p.lastEvent.current=n;const f=a==="onPointerMove",m=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",b=i(n,f?r:void 0),c=m?t(n):0;a==="onPointerDown"&&(p.initialClick=[n.offsetX,n.offsetY],p.initialHits=b.map(g=>g.eventObject)),m&&!b.length&&c<=2&&(h(n,p.interaction),o&&o(n)),f&&l(b);function u(g){const C=g.eventObject,E=C.__r3f,_=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(f){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const x=we(g),O=p.hovered.get(x);O?O.stopped&&g.stopPropagation():(p.hovered.set(x,g),_.onPointerOver==null||_.onPointerOver(g),_.onPointerEnter==null||_.onPointerEnter(g))}_.onPointerMove==null||_.onPointerMove(g)}else{const x=_[a];x?(!m||p.initialHits.includes(C))&&(h(n,p.interaction.filter(O=>!p.initialHits.includes(O))),x(g)):m&&p.initialHits.includes(C)&&h(n,p.interaction.filter(O=>!p.initialHits.includes(O)))}}s(b,n,c,u)}}return{handlePointer:v}}const vt=e=>!!(e!=null&&e.render),ht=d.createContext(null),br=(e,t)=>{const r=it((v,a)=>{const y=new N,n=new N,o=new N;function p(c=a().camera,u=n,g=a().size){const{width:C,height:E,top:_,left:x}=g,O=C/E;u instanceof N?o.copy(u):o.set(...u);const M=c.getWorldPosition(y).distanceTo(o);if(ct(c))return{width:C/c.zoom,height:E/c.zoom,top:_,left:x,factor:1,distance:M,aspect:O};{const S=c.fov*Math.PI/180,w=2*Math.tan(S/2)*M,j=w*(C/E);return{width:j,height:w,top:_,left:x,factor:C/j,distance:M,aspect:O}}}let f;const m=c=>v(u=>({performance:{...u.performance,current:c}})),P=new It;return{set:v,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(c=1)=>e(a(),c),advance:(c,u)=>t(c,u,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Nt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const c=a();f&&clearTimeout(f),c.performance.current!==c.performance.min&&m(c.performance.min),f=setTimeout(()=>m(a().performance.max),c.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:c=>v(u=>({...u,events:{...u.events,...c}})),setSize:(c,u,g,C,E)=>{const _=a().camera,x={width:c,height:u,top:C||0,left:E||0,updateStyle:g};v(O=>({size:x,viewport:{...O.viewport,...p(_,n,x)}}))},setDpr:c=>v(u=>{const g=dt(c);return{viewport:{...u.viewport,dpr:g,initialDpr:u.viewport.initialDpr||g}}}),setFrameloop:(c="always")=>{const u=a().clock;u.stop(),u.elapsedTime=0,c!=="never"&&(u.start(),u.elapsedTime=0),v(()=>({frameloop:c}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:d.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(c,u,g)=>{const C=a().internal;return C.priority=C.priority+(u>0?1:0),C.subscribers.push({ref:c,priority:u,store:g}),C.subscribers=C.subscribers.sort((E,_)=>E.priority-_.priority),()=>{const E=a().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(u>0?1:0),E.subscribers=E.subscribers.filter(_=>_.ref!==c))}}}}}),i=r.getState();let s=i.size,l=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:v,size:a,viewport:y,gl:n,set:o}=r.getState();if(a!==s||y.dpr!==l){var p;s=a,l=y.dpr,vr(v,a),n.setPixelRatio(y.dpr);const f=(p=a.updateStyle)!=null?p:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(a.width,a.height,f)}v!==h&&(h=v,o(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let _e,wr=new Set,_r=new Set,Er=new Set;function Te(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function ue(e,t){switch(e){case"before":return Te(wr,t);case"after":return Te(_r,t);case"tail":return Te(Er,t)}}let Le,De;function ke(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Le=t.internal.subscribers,_e=0;_e<Le.length;_e++)De=Le[_e],De.ref.current(De.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Pr(e){let t=!1,r,i,s;function l(a){i=requestAnimationFrame(l),t=!0,r=0,ue("before",a);for(const n of e.values()){var y;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((y=s.gl.xr)!=null&&y.isPresenting)&&(r+=ke(a,s))}if(ue("after",a),r===0)return ue("tail",a),t=!1,cancelAnimationFrame(i)}function h(a,y=1){var n;if(!a)return e.forEach(o=>h(o.store.getState()),y);(n=a.gl.xr)!=null&&n.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+y),t||(t=!0,requestAnimationFrame(l)))}function v(a,y=!0,n,o){if(y&&ue("before",a),n)ke(a,n,o);else for(const p of e.values())ke(a,p.store.getState());y&&ue("after",a)}return{loop:l,invalidate:h,advance:v}}function gt(){const e=d.useContext(ht);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function B(e=r=>r,t){return gt()(e,t)}function Ce(e,t=0){const r=gt(),i=r.getState().internal.subscribe,s=lt(e);return pe(()=>i(s,t,r),[t,i,r]),null}function yt(e,t){return function(r,...i){const s=new r;return e&&e(s),Promise.all(i.map(l=>new Promise((h,v)=>s.load(l,a=>{a.scene&&Object.assign(a,pr(a.scene)),h(a)},t,a=>v(new Error(`Could not load ${l}: ${a.message}`))))))}}function me(e,t,r,i){const s=Array.isArray(t)?t:[t],l=ir(yt(r,i),[e,...s],{equal:T.equ});return Array.isArray(t)?l:l[0]}me.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return sr(yt(r),[e,...i])};me.clear=function(e,t){const r=Array.isArray(t)?t:[t];return ar([e,...r])};const ae=new Map,{invalidate:tt,advance:rt}=Pr(ae),{reconciler:Pe,applyProps:te}=lr(ae,hr),re={objects:"shallow",strict:!1},Cr=(e,t)=>{const r=typeof e=="function"?e(t):e;return vt(r)?r:new Ht({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Mr(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:i,top:s,left:l}=e.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:l}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function xr(e){const t=ae.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,l=i||br(tt,rt),h=r||Pe.createContainer(l,ie.ConcurrentRoot,null,!1,null,"",s,null);t||ae.set(e,{fiber:h,store:l});let v,a=!1,y;return{configure(n={}){let{gl:o,size:p,scene:f,events:m,onCreated:P,shadows:b=!1,linear:c=!1,flat:u=!1,legacy:g=!1,orthographic:C=!1,frameloop:E="always",dpr:_=[1,2],performance:x,raycaster:O,camera:M,onPointerMissed:S}=n,w=l.getState(),j=w.gl;w.gl||w.set({gl:j=Cr(o,e)});let H=w.raycaster;H||w.set({raycaster:H=new Lt});const{params:Q,...D}=O||{};if(T.equ(D,H,re)||te(H,{...D}),T.equ(Q,H.params,re)||te(H,{params:{...H.params,...Q}}),!w.camera||w.camera===y&&!T.equ(y,M,re)){y=M;const R=M instanceof Bt,L=R?M:C?new He(0,0,0,0,.1,1e3):new Be(75,0,.1,1e3);R||(L.position.z=5,M&&te(L,M),!w.camera&&!(M!=null&&M.rotation)&&L.lookAt(0,0,0)),w.set({camera:L})}if(!w.scene){let R;f instanceof Xe?R=f:(R=new Xe,f&&te(R,f)),w.set({scene:ne(R)})}if(!w.xr){var X;const R=(F,he)=>{const ge=l.getState();ge.frameloop!=="never"&&rt(F,!0,ge,he)},L=()=>{const F=l.getState();F.gl.xr.enabled=F.gl.xr.isPresenting,F.gl.xr.setAnimationLoop(F.gl.xr.isPresenting?R:null),F.gl.xr.isPresenting||tt(F)},G={connect(){const F=l.getState().gl;F.xr.addEventListener("sessionstart",L),F.xr.addEventListener("sessionend",L)},disconnect(){const F=l.getState().gl;F.xr.removeEventListener("sessionstart",L),F.xr.removeEventListener("sessionend",L)}};typeof((X=j.xr)==null?void 0:X.addEventListener)=="function"&&G.connect(),w.set({xr:G})}if(j.shadowMap){const R=j.shadowMap.enabled,L=j.shadowMap.type;if(j.shadowMap.enabled=!!b,T.boo(b))j.shadowMap.type=Se;else if(T.str(b)){var k;const G={basic:$t,percentage:Gt,soft:Se,variance:Ut};j.shadowMap.type=(k=G[b])!=null?k:Se}else T.obj(b)&&Object.assign(j.shadowMap,b);(R!==j.shadowMap.enabled||L!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const U=at();U&&("enabled"in U?U.enabled=!g:"legacyMode"in U&&(U.legacyMode=g)),te(j,{outputEncoding:c?3e3:3001,toneMapping:u?Dt:kt}),w.legacy!==g&&w.set(()=>({legacy:g})),w.linear!==c&&w.set(()=>({linear:c})),w.flat!==u&&w.set(()=>({flat:u})),o&&!T.fun(o)&&!vt(o)&&!T.equ(o,j,re)&&te(j,o),m&&!w.events.handlers&&w.set({events:m(l)});const W=Mr(e,p);return T.equ(W,w.size,re)||w.setSize(W.width,W.height,W.updateStyle,W.top,W.left),_&&w.viewport.dpr!==dt(_)&&w.setDpr(_),w.frameloop!==E&&w.setFrameloop(E),w.onPointerMissed||w.set({onPointerMissed:S}),x&&!T.equ(x,w.performance,re)&&w.set(R=>({performance:{...R.performance,...x}})),v=P,a=!0,this},render(n){return a||this.configure(),Pe.updateContainer(d.createElement(Sr,{store:l,children:n,onCreated:v,rootElement:e}),h,null,()=>{}),l},unmount(){bt(e)}}}function Sr({store:e,children:t,onCreated:r,rootElement:i}){return pe(()=>{const s=e.getState();s.set(l=>({internal:{...l.internal,active:!0}})),r&&r(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),d.createElement(ht.Provider,{value:e},t)}function bt(e,t){const r=ae.get(e),i=r==null?void 0:r.fiber;if(i){const s=r==null?void 0:r.store.getState();s&&(s.internal.active=!1),Pe.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var l,h,v,a;s.events.disconnect==null||s.events.disconnect(),(l=s.gl)==null||(h=l.renderLists)==null||h.dispose==null||h.dispose(),(v=s.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),mr(s),ae.delete(e),t&&t(e)}catch{}},500)})}}Pe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version});const Fe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Rr(e){const{handlePointer:t}=yr(e);return{priority:1,enabled:!0,compute(r,i,s){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Fe).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:s}=e.getState();(r=s.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:r=>{var i;const{set:s,events:l}=e.getState();l.disconnect==null||l.disconnect(),s(h=>({events:{...h.events,connected:r}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([h,v])=>{const[a,y]=Fe[h];r.addEventListener(a,v,{passive:y})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([l,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Fe[l];i.connected.removeEventListener(v,h)}}),r(l=>({events:{...l.events,connected:void 0}}))}}}}const Or=d.forwardRef(function({children:t,fallback:r,resize:i,style:s,gl:l,events:h=Rr,eventSource:v,eventPrefix:a,shadows:y,linear:n,flat:o,legacy:p,orthographic:f,frameloop:m,dpr:P,performance:b,raycaster:c,camera:u,onPointerMissed:g,onCreated:C,...E},_){d.useMemo(()=>cr(qt),[]);const x=er(),[O,M]=Jt({scroll:!0,debounce:{scroll:50,resize:0},...i}),S=d.useRef(null),w=d.useRef(null);d.useImperativeHandle(_,()=>S.current);const j=lt(g),[H,Q]=d.useState(!1),[D,X]=d.useState(!1);if(H)throw H;if(D)throw D;const k=d.useRef(null);pe(()=>{const $=S.current;M.width>0&&M.height>0&&$&&(k.current||(k.current=xr($)),k.current.configure({gl:l,events:h,shadows:y,linear:n,flat:o,legacy:p,orthographic:f,frameloop:m,dpr:P,performance:b,raycaster:c,camera:u,size:M,onPointerMissed:(...z)=>j.current==null?void 0:j.current(...z),onCreated:z=>{z.events.connect==null||z.events.connect(v?ur(v)?v.current:v:w.current),a&&z.setEvents({compute:(W,R)=>{const L=W[a+"X"],G=W[a+"Y"];R.pointer.set(L/R.size.width*2-1,-(G/R.size.height)*2+1),R.raycaster.setFromCamera(R.pointer,R.camera)}}),C==null||C(z)}}),k.current.render(d.createElement(x,null,d.createElement(ut,{set:X},d.createElement(d.Suspense,{fallback:d.createElement(fr,{set:Q})},t)))))}),d.useEffect(()=>{const $=S.current;if($)return()=>bt($)},[]);const U=v?"none":"auto";return d.createElement("div",V({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:U,...s}},E),d.createElement("div",{ref:O,style:{width:"100%",height:"100%"}},d.createElement("canvas",{ref:S,style:{display:"block"}},r)))}),tn=d.forwardRef(function(t,r){return d.createElement(Qt,null,d.createElement(Or,V({},t,{ref:r})))}),ve=new N,Ue=new N,jr=new N;function Ar(e,t,r){const i=ve.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=r.width/2,l=r.height/2;return[i.x*s+s,-(i.y*l)+l]}function Tr(e,t){const r=ve.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),s=r.sub(i),l=t.getWorldDirection(jr);return s.angleTo(l)>Math.PI/2}function Lr(e,t,r,i){const s=ve.setFromMatrixPosition(e.matrixWorld),l=s.clone();l.project(t),r.setFromCamera(l,t);const h=r.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return s.distanceTo(r.ray.origin)<v}return!0}function Dr(e,t){if(t instanceof He)return t.zoom;if(t instanceof Be){const r=ve.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,l=r.distanceTo(i);return 1/(2*Math.tan(s/2)*l)}else return 1}function kr(e,t,r){if(t instanceof Be||t instanceof He){const i=ve.setFromMatrixPosition(e.matrixWorld),s=Ue.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(s),h=(r[1]-r[0])/(t.far-t.near),v=r[1]-h*t.far;return Math.round(h*l+v)}}const Ie=e=>Math.abs(e)<1e-10?0:e;function wt(e,t,r=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=Ie(t[s]*e.elements[s])+(s!==15?",":")");return r+i}const Fr=(e=>t=>wt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),zr=(e=>(t,r)=>wt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Wr(e){return e&&typeof e=="object"&&"current"in e}const rn=d.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:s,center:l,fullscreen:h,portal:v,distanceFactor:a,sprite:y=!1,transform:n=!1,occlude:o,onOcclude:p,castShadow:f,receiveShadow:m,material:P,geometry:b,zIndexRange:c=[16777271,0],calculatePosition:u=Ar,as:g="div",wrapperClass:C,pointerEvents:E="auto",..._},x)=>{const{gl:O,camera:M,scene:S,size:w,raycaster:j,events:H,viewport:Q}=B(),[D]=d.useState(()=>document.createElement(g)),X=d.useRef(),k=d.useRef(null),U=d.useRef(0),$=d.useRef([0,0]),z=d.useRef(null),W=d.useRef(null),R=(v==null?void 0:v.current)||H.connected||O.domElement.parentNode,L=d.useRef(null),G=d.useRef(!1),F=d.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Wr(o[0]),[o]);d.useLayoutEffect(()=>{const I=O.domElement;o&&o==="blending"?(I.style.zIndex=`${Math.floor(c[0]/2)}`,I.style.position="absolute",I.style.pointerEvents="none"):(I.style.zIndex=null,I.style.position=null,I.style.pointerEvents=null)},[o]),d.useLayoutEffect(()=>{if(k.current){const I=X.current=rr(D);if(S.updateMatrixWorld(),n)D.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const A=u(k.current,M,w);D.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${A[0]}px,${A[1]}px,0);transform-origin:0 0;`}return R&&(s?R.prepend(D):R.appendChild(D)),()=>{R&&R.removeChild(D),I.unmount()}}},[R,n]),d.useLayoutEffect(()=>{C&&(D.className=C)},[C]);const he=d.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,l,h,w,n]),ge=d.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);d.useLayoutEffect(()=>{if(G.current=!1,n){var I;(I=X.current)==null||I.render(d.createElement("div",{ref:z,style:he},d.createElement("div",{ref:W,style:ge},d.createElement("div",{ref:x,className:i,style:r,children:e}))))}else{var A;(A=X.current)==null||A.render(d.createElement("div",{ref:x,style:he,className:i,children:e}))}});const ee=d.useRef(!0);Ce(I=>{if(k.current){M.updateMatrixWorld(),k.current.updateWorldMatrix(!0,!1);const A=n?$.current:u(k.current,M,w);if(n||Math.abs(U.current-M.zoom)>t||Math.abs($.current[0]-A[0])>t||Math.abs($.current[1]-A[1])>t){const Y=Tr(k.current,M);let q=!1;F&&(o!=="blending"?q=[S]:Array.isArray(o)&&(q=o.map(Z=>Z.current)));const ce=ee.current;if(q){const Z=Lr(k.current,M,j,q);ee.current=Z&&!Y}else ee.current=!Y;ce!==ee.current&&(p?p(!ee.current):D.style.display=ee.current?"block":"none");const ye=Math.floor(c[0]/2),Pt=o?F?[c[0],ye]:[ye-1,0]:c;if(D.style.zIndex=`${kr(k.current,M,Pt)}`,n){const[Z,qe]=[w.width/2,w.height/2],Me=M.projectionMatrix.elements[5]*qe,{isOrthographicCamera:Ve,top:Ct,left:Mt,bottom:xt,right:St}=M,Rt=Fr(M.matrixWorldInverse),Ot=Ve?`scale(${Me})translate(${Ie(-(St+Mt)/2)}px,${Ie((Ct+xt)/2)}px)`:`translateZ(${Me}px)`;let K=k.current.matrixWorld;y&&(K=M.matrixWorldInverse.clone().transpose().copyPosition(K).scale(k.current.scale),K.elements[3]=K.elements[7]=K.elements[11]=0,K.elements[15]=1),D.style.width=w.width+"px",D.style.height=w.height+"px",D.style.perspective=Ve?"":`${Me}px`,z.current&&W.current&&(z.current.style.transform=`${Ot}${Rt}translate(${Z}px,${qe}px)`,W.current.style.transform=zr(K,1/((a||10)/400)))}else{const Z=a===void 0?1:Dr(k.current,M)*a;D.style.transform=`translate3d(${A[0]}px,${A[1]}px,0) scale(${Z})`}$.current=A,U.current=M.zoom}}if(!F&&L.current&&!G.current)if(n){if(z.current){const A=z.current.children[0];if(A!=null&&A.clientWidth&&A!=null&&A.clientHeight){const{isOrthographicCamera:Y}=M;if(Y||b)_.scale&&(Array.isArray(_.scale)?_.scale instanceof N?L.current.scale.copy(_.scale.clone().divideScalar(1)):L.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):L.current.scale.setScalar(1/_.scale));else{const q=(a||10)/400,ce=A.clientWidth*q,ye=A.clientHeight*q;L.current.scale.set(ce,ye,1)}G.current=!0}}}else{const A=D.children[0];if(A!=null&&A.clientWidth&&A!=null&&A.clientHeight){const Y=1/Q.factor,q=A.clientWidth*Y,ce=A.clientHeight*Y;L.current.scale.set(q,ce,1),G.current=!0}L.current.lookAt(I.camera.position)}});const Ne=d.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return d.createElement("group",V({},_,{ref:k}),o&&!F&&d.createElement("mesh",{castShadow:f,receiveShadow:m,ref:L},b||d.createElement("planeGeometry",null),P||d.createElement("shaderMaterial",{side:Vt,vertexShader:Ne.vertexShader,fragmentShader:Ne.fragmentShader})))});let fe=0;const nn=it(e=>(be.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-fe)/(i-fe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(r=>({errors:[...r.errors,t]})),be.onProgress=(t,r,i)=>{r===i&&(fe=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-fe)/(i-fe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));let Ee=null;function _t(e,t,r){return i=>{r&&r(i),e&&(Ee||(Ee=new nr),Ee.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(Ee)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function Et(e,t=!0,r=!0,i){return me($e,e,_t(t,r,i))}Et.preload=(e,t=!0,r=!0,i)=>me.preload($e,e,_t(t,r,i));Et.clear=e=>me.clear($e,e);const on=d.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:s=!0,keyEvents:l=!1,onChange:h,onStart:v,onEnd:a,...y},n)=>{const o=B(_=>_.invalidate),p=B(_=>_.camera),f=B(_=>_.gl),m=B(_=>_.events),P=B(_=>_.setEvents),b=B(_=>_.set),c=B(_=>_.get),u=B(_=>_.performance),g=t||p,C=i||m.connected||f.domElement,E=d.useMemo(()=>new or(g),[g]);return Ce(()=>{E.enabled&&E.update()},-1),d.useEffect(()=>(l&&E.connect(l===!0?C:l),E.connect(C),()=>void E.dispose()),[l,C,r,E,o]),d.useEffect(()=>{const _=M=>{o(),r&&u.regress(),h&&h(M)},x=M=>{v&&v(M)},O=M=>{a&&a(M)};return E.addEventListener("change",_),E.addEventListener("start",x),E.addEventListener("end",O),()=>{E.removeEventListener("start",x),E.removeEventListener("end",O),E.removeEventListener("change",_)}},[h,v,a,E,o,P]),d.useEffect(()=>{if(e){const _=c().controls;return b({controls:E}),()=>b({controls:_})}},[e,E]),d.createElement("primitive",V({ref:n,object:E,enableDamping:s},y))});class Ir extends Xt{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:s}=i.capabilities;r.fragmentShader=r.fragmentShader.replace("#include <output_fragment>",`
        ${s?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const sn=d.forwardRef((e,t)=>{const[r]=d.useState(()=>new Ir(null));return d.createElement("primitive",V({},e,{object:r,ref:t,attach:"material"}))});let J,de;const Hr=d.createContext(null),nt=new Yt,ot=new N,Br=d.forwardRef(({children:e,range:t,limit:r=1e3,...i},s)=>{const l=d.useRef(null),[h,v]=d.useState([]),[[a,y,n]]=d.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);d.useEffect(()=>{l.current.geometry.attributes.position.needsUpdate=!0}),Ce(()=>{for(l.current.updateMatrix(),l.current.updateMatrixWorld(),nt.copy(l.current.matrixWorld).invert(),l.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,h.length),J=0;J<h.length;J++)de=h[J].current,de.getWorldPosition(ot).applyMatrix4(nt),ot.toArray(a,J*3),l.current.geometry.attributes.position.needsUpdate=!0,de.matrixWorldNeedsUpdate=!0,de.color.toArray(y,J*3),l.current.geometry.attributes.color.needsUpdate=!0,n.set([de.size],J),l.current.geometry.attributes.size.needsUpdate=!0});const o=d.useMemo(()=>({getParent:()=>l,subscribe:p=>(v(f=>[...f,p]),()=>v(f=>f.filter(m=>m.current!==p.current)))}),[]);return d.createElement("points",V({userData:{instances:h},matrixAutoUpdate:!1,ref:st([s,l]),raycast:()=>null},i),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:a.length/3,array:a,itemSize:3,usage:se}),d.createElement("bufferAttribute",{attach:"attributes-color",count:y.length/3,array:y,itemSize:3,usage:se}),d.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:se})),d.createElement(Hr.Provider,{value:o},e))}),$r=d.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:s=3,...l},h)=>{const v=d.useRef(null);return Ce(()=>{const a=v.current.geometry.attributes;a.position.needsUpdate=!0,r&&(a.color.needsUpdate=!0),i&&(a.size.needsUpdate=!0)}),d.createElement("points",V({ref:st([h,v])},l),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:se}),r&&d.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/s,array:r,itemSize:3,usage:se}),i&&d.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:se})),e)}),an=d.forwardRef((e,t)=>e.positions instanceof Float32Array?d.createElement($r,V({},e,{ref:t})):d.createElement(Br,V({},e,{ref:t})));function cn({all:e,scene:t,camera:r}){const i=B(({gl:h})=>h),s=B(({camera:h})=>h),l=B(({scene:h})=>h);return d.useLayoutEffect(()=>{const h=[];e&&(t||l).traverse(y=>{y.visible===!1&&(h.push(y),y.visible=!0)}),i.compile(t||l,r||s);const v=new Zt(128);new Kt(.01,1e5,v).update(i,t||l),v.dispose(),h.forEach(y=>y.visible=!1)},[]),null}export{tn as C,rn as H,on as O,cn as P,Et as a,Ce as b,an as c,sn as d,nn as u};
